name: 2 - [DEV] DevSecOps Pipeline

on:
  pull_request:
    branches: [ "develop" ]
    types: closed

jobs:
  devsecops:
    # üß™ SAST - Trivy
    name: DevSecOps
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write

    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      #- name: Set up JDK ${{ matrix.java }}
      #  uses: actions/setup-java@v3
      #  with:
      #    distribution: 'temurin'
      #    java-version: 21
      #    cache: maven

      #- name: Test with Maven
      #  run: mvn clean -U install

      - name: Listar arquivos
        run: |
          ls -la

      #- name: Extrair JAR
      #  run: unzip target/*.jar

      - name: Listar arquivos
        run: |
          ls -la

      - name: Run Trivy vulnerability scanner in fs mode
        uses: aquasecurity/trivy-action@0.28.0
        with:
          scan-type: 'fs'
          scan-ref: '.'
          format: 'sarif'
          severity: 'HIGH,CRITICAL'
          ignore-unfixed: true
          scanners: 'vuln,secret,misconfig'
          exit-code: '1'  # ‚ö†Ô∏è Falha o build se encontrar vulnerabilidades

